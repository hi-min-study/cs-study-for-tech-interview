# 05 - 보안

- 보안
    - CORS
    - XSS
    - SQL Injection
- 웹 통신의 흐름
    - google.com을 입력했을 때 동작원리
- CSRF

# 면접 질문

### 1. CORS가 무엇인가요?

CORS는 **Cross Origin Resource Sharing**의 약자로, **서로 다른 출처에서 리소스를 공유하는 것을 허용하는 정책**입니다. 브라우저는 기본적으로 서로 다른 출처에 대해서 공유를 제한하는 **SOP**을 따릅니다. 여기서 SOP란 **Same Origin Policy**의 약자로 **같은 출처끼리만 리소스를 공유**할 수 있다는 정책입니다. 여기서 말하는 출처, ORIGIN이란 **Protocol + Host + Port 를 합친 것**을 말합니다.

Origin이 같으면 CORS 에러는 발생하지 않습니다.

### 2. CORS의 동작원리

CORS의 동작원리는 간략하게 설명하면, **서버와 통신을 할 때 응답을 받는 브라우저에서 요청 헤더의 Origin 필드와응답 헤더의 Access-Control-Allow-Origin 필드를 비교하여 응답의 유효성을 판단하는 것**입니다. 즉, 요청을 보내는 쪽에서 요청 허더에 리소스를 필요로하는 URL을 Origin 필드에 담아서 보내고, 응답을 보내는 서버 쪽에선 Access-Control-Allow-Origin 필드에 리소스 접근이 허용된 출처를 담아서 보내 브라우저가 이를 비교하는 것입니다.

### 3. CORS를 해결하는 방법

서버에서 응답 헤더에 특정 헤더를 포함하는 방식으로 해결할 수 있습니다.

Access-Control-Allow-Origin: 특정 브라우저가 리소스에 접근이 가능하도록 허용합니다.

Access-Control-Allow-Method: 특정 HTTP Method만 리소스에 접근이 가능하도록 허용합니다.

Access-Control-Expose-Headers: 자바스크립트에서 헤더에 접근할 수 있도록 허용합니다.

credentials: 쿠키 등의 인증 정보를 전달할 수 있습니다.

# **SQL 인젝션의 개념**

SQL 인젝션은 데이터베이스 시스템에 비정상적인 SQL 쿼리를 주입하여, 보안상 취약점을 이용해 데이터베이스를 조작하는 공격 기법입니다. 이는 웹 애플리케이션과 데이터베이스 사이의 상호작용 시 발생할 수 있으며, 권한이 없는 데이터에 접근하거나 수정, 삭제할 수 있게 만듭니다.

## **SQL 인젝션 공격을 예방하기 위한 방법은 무엇인가요?**

SQL 인젝션을 예방하기 위해서는 다음과 같은 방법을 사용할 수 있습니다.

- 사용자 입력 값을 매개변수화한 쿼리 사용: PreparedStatement 사용 등의 매개변수화를 통해 SQL 코드를 생성하면, 사용자 입력 값이 SQL 명령어로 인식되지 않도록 할 수 있습니다.

```sql
PreparedStatement pstmt = con.prepareStatement("SELECT * FROM users WHERE userID = ?");
pstmt.setString(1, userID);
ResultSet results = pstmt.executeQuery();

```

- 데이터 입력 값 살규화: 사용자 입력 값을 허용된 값만 받아들일 수 있도록 필터링합니다.
- 적절한 에러 메시지 사용: 데이터베이스 오류가 사용자에게 전달되지 않도록 합니다.

## XSS(Cross site scripting) 공격에 대해서 설명하고 방어 기법에 대해서 설명해주세요.

**XSS(Cross-Site Scripting) 는**

관리자가 아닌, 권한이 없는 사용자가 웹 사이트에 스크립트를 삽입하는 공격 기법입니다. 

**특징으로는**

대부분 사용자가 글을 쓰고 읽을 수 있는 게시판에 많이 발생하지만, 사용자의 입력 값을 웹 페이지에 보여주는 곳에서도 발생한다.

악의적인 사용자가 C&C 서버로 리다이렉션 하기 위해 리다이렉션 스크립트를 주입하여 중간 경유지로 활용하기도 하고,

사용자의 쿠키를 탈취하여 세션 하이재킹(Session Hijacking) 공격을 수행하기도 한다.

**해결방안**

1. 입출력값 검증

XXS는 입출력 값 검증이 제대로 이루어지지 않아 발생하는 취약점입니다.

따라서 서버측에서 사용자의 모든 입력값에 대해서 필터링을 해주어야 합니다.

주로 스크립트를 실행하기 위한 특수 문자를 필터링 해줍니다.

2. XXS 방어 라이브러리, 브라우저 확장 앱 사용

회사측은 XSS를 막아주는 Anti XSS 라이브러리를 여러 회사에서 제공하는데 이 라이브러리를 사용하면 손쉽게 XSS를 방어할 수 있습니다. XSS 라이브러리를 사용하는 것은 서버 단에서 개발자가 추가하는 것이다.

사용자측은 브라우저 확장 앱 중 Anti XSS 를 해주는 애플리케이션을 설치하고 방어하여야 한다.

3. 웹 방화벽 사용

## CSRF(Cross site request forgery)에 대해서 설명하고 방어 기법에 대해서 설명해주세요.

웹 어플리케이션 취약점 중 하나로 공격자가 의도한대로 사용자가 행동하게 하여 특정 웹페이지를 보안에 취약하게 한다거나 수정, 삭제 등의 작업을 하게 만드는 공격 방법을 의미합니다.

1.사용자의 요청에 referrer를 확인하여 도메인이 일치하는지 확인하는 방법으로 공격을 방어

2.상태를 변화시키는 POST, PUT 등의 요청에 대해 csrf 토큰이 포함되어야만 요청을 처리하여 공격을 방어

## XSS와 CSRF의 차이는 무엇인가요 ?

XSS와 CSRF의 가장 큰 차이는 서로 공격을 수행하는 지점이 다르다는것입니다.

XSS는 클라이언트가 페이지를 믿는다는 전제를 하고 클라이언트 사이드로 공격을 진행하고 CSRF는 서버가 응답받은 데이터를 믿는다는 것을 전제로 하고 서버를 공격하는 방식이다.

따라서 XSS는 클라이언트 사이드를 공격을 진행하는 것이고 CSRF는 서버 사이드를 공격하는 차이가 있습니다.

## google.com을 입력했을 때 동작원리에 대해 말해주세요.

1. 사용자가 웹브라우저 검색창에 www.goolgle.com 입력한다.

2. 웹브라우저는 캐싱된 DNS기록들을 통해 해당 도메인 주소와 대응하는 IP주소를 확인한다.

3. 웹브라우저가 HTTP를 사용하여 DNS에게 입력된 도메인 주소를 요청한다.

4. DNS가 웹브라우저에게 찾는 사이트의 IP주소를 응답한다.

5. 웹브라우저가 웹서버에게 IP주소를 이용하여 html 문서를 요청한다.

6. 웹 어플리케이션서버(WAS)와 데이터베이스에서 우선 웹페이지 작업을 처리한다.

7. 6번의 작업 처리 결과를 웹서버로 전송한다.

8. 웹서버는 웹브라우저에게 html 문서결과를 응답한다.

9. 웹브라우저는 화면에 웹페이지 내용물을 출력한다.

출처:

https://dev-coco.tistory.com/164

https://lisoft.tistory.com/22

https://velog.io/@jdk9908/CSRF-Cross-Site-Request-Forgery
