# DB - 확장

- 수직적 확장과 수평적 분할
- Master/Slave
- Sharding, Partitioning
- CAP 이론



# 면접 질문

### DB 확장을 하는 두가지 방법이 무엇인가요 ?

수직적 확장과 수평적 확장입니다.

### (꼬리질문) 수직적 확장에 대해서 설명해주세요.

**단일 서버의 스펙을 단순히 더 좋은 것으로 업그레이드 하는 것**이 수직 확장입니다.

장점으로는 수직 확장은 확장 과정이 비교적 간단합니다. 단 하나의 서버만을 관리하면 되므로 여러 서버를 클러스터링하고, 데이터 일관성을 유지하기 위한 비용이 발생하지 않습니다.

단점으로는 수직적 확장시에는 비용적으로 한계가 존재하고, 서버의 스펙을 업그레이드 할 때 발생하는 다운타임또한 발생할 수 있습니다.

또한 단일 서버로 서비스를 운영하기 때문에 하나의 서버로 부하가 집중되고 장애에 취약하다는 문제점이 있습니다.

### (꼬리질문) 수평적 확장에 대해서 설명해주세요.

운영중인 서버의 부품을 더 좋은 것으로 바꾸는 대신, **여러대의 서버를 추가로 설치**하는 방식을 수평적 확장 이라고 합니다. 

장점으로는 단일 장애점을 갖지 않으므로 장애에 치명적이지 않다. 또한 **이론적으로 확장에 제한이 없어 무한대로 확장**할 수 있습니다.

단점으로는 수평 확장은 수직 확장과 다르게 여러 서버를 한 서버처럼 사용하기 위한 **클러스터링 작업에 로드밸런서와 같은 추가 비용이 발생합니다**. 따라서 **기술적으로나 관리적으로나 수직 확장에 비해 까다롭고, 어렵습니다.** 또한 여러대의 서버들은 일반적으로 네트워크를 통해 연결되므로, 네트워크 상황에 따라 확장을 하더라도 원하는 성능을 얻지 못 할수도 있습니다.

### Master/Slave란 무엇인가요 ?

데이터 원본은 주(Master)서버에, 사본은 부(Slave)서버에 저장하는 방식입니다.

쓰기(Write)는 마스터에서만 지원하고, 부(Slave)서버는 DB사본을 갱신하면서, 읽기만을 지원합니다. 

### (꼬리질문) Master/Slave의 동작 원리에 대해 설명해주세요.

1. 사용자는 URL로 사이트에 접속하면 로드밸런서 IP 주소를 받습니다.
2. 사용자는 로드밸런서에 접속합니다.
3. 사용자의 요청은 웹 서버1 또는 웹 서버2로 전달됩니다.
4. 웹서버는 쓰기(Write)라면 MasterDB, 읽기(Read)라면 SlaveDB에 접근합니다.

### (꼬리질문) Master/Slave의 장단점에 대해 설명해주세요.

장점으로는 주 연산에 해당하는 읽기(Write) 연산을 병렬로 처리가 가능하고, 일부가 손상, 파괴되어도 데이터가 보존된다는 것입니다. 

딘점은 slave가 갱신되기 전에 조회 시 데이터 불일치가 발생할 수 있습니다.

### DB 분할 방법에는 어떤것이 있나요 ?

Partitioning과 Sharding이 있습니다.

### (꼬리질문) Partitioning에 대해서 설명해주세요.

파티셔닝은 매우 큰 테이블을 여러개의 테이블로 분할하는 작업입니다. 큰 데이터를 여러 테이블로 나눠 저장하기 때문에 쿼리 성능이 개선될 수 있습니다. 이때, 데이터는 **물리적으로 여러 테이블로 분산**하여 저장되지만, 사용자는 마치 **하나의 테이블에 접근하는 것과 같이 사용**할 수 있다는 점이 특징입니다. 파티셔닝은 MySQL 단에서 자체적으로 지원하는 기능입니다.

### (꼬리질문) Sharding에 대해서 설명해주세요.

샤딩은 **동일한 스키마**를 가지고 있는 여러대의 데이터베이스 서버들에 데이터를 **작은 단위로 나누어 분산 저장**하는 기법입니다. 이때, 작은 단위를 **샤드(shard)**라고 부릅니다.

### CAP 이론이란 무엇인가요 ?

 CAP 이론은 C(일관성 consistency), A(가용성 availability), P(파티션 감내 Partition Tolerance theorem) **3가지 가운데 2가지를 충족하려면 나머지 하나는 반드시 희생되어야 한다**는 것을 의미합니다.




## Ref

https://taegyunwoo.github.io/interview/Interview_SystemDesign

https://jaehoney.tistory.com/122

https://thalals.tistory.com/396

https://hudi.blog/db-partitioning-and-sharding/

https://hudi.blog/scale-up-vs-scale-out/
